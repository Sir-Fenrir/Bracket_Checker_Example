name: 'build'

# Defining the triggers
on: 
  push:
    branches:
      - main
  pull_request:
    branches:
      - main

# Workflow is made up of jobs, which run in parallel by default
jobs:
  build: # I've given this job the tag 'build'
    runs-on: ubuntu-latest # Required to tell what it runs on
    name: Run Build & Test # The name I've given

    # with the 'if' keyword, you can add conditions which must match, otherwise the job won't run. See https://docs.github.com/en/actions/reference/workflows-and-actions/expressions

    steps:
      - name: Checkout code
        uses: actions/checkout@v6.0.0

      - name: Setup dotnet 10
        uses: actions/setup-dotnet@v5
        with:
          dotnet-version: '10.0.x'

      # One restore, so we can use it both for the build and the test
      - run: dotnet restore

      - run: dotnet build --no-restore

      - run: dotnet test --no-build


  analyze:
    name: Analyze C#
    runs-on: 'ubuntu-latest'
    permissions:
      # required for all workflows
      security-events: write
  
      # required to fetch internal or private CodeQL packs
      packages: read
  
      # only required for workflows in private repositories
      actions: read
      contents: read
  
    steps:
    - name: Checkout repository
      uses: actions/checkout@v4
  
    # Add any setup steps before running the `github/codeql-action/init` action.
    # This includes steps like installing compilers or runtimes (`actions/setup-node`
    # or others). This is typically only required for manual builds.
    # - name: Setup runtime (example)
    #   uses: actions/setup-example@v1
  
    # Initializes the CodeQL tools for scanning.
    - name: Initialize CodeQL
      uses: github/codeql-action/init@v4
      with:
        languages: csharp
        build-mode: none
  
    - name: Perform CodeQL Analysis
      uses: github/codeql-action/analyze@v4
      with:
        category: "/language:csharp"

      
  dependency-check: 
    runs-on: ubuntu-latest
    name: Checking dependencies
    # We only do this when we add new code using a pull request,
    # For general information about dependency vulnerabilities GitHub already offers Dependabot.
    if: ${{ github.event_name == 'pull_request' }}

    steps:
      - name: Checkout code
        uses: actions/checkout@v6.0.0

      - name: 'Dependency Review'
        uses: actions/dependency-review-action@v4


